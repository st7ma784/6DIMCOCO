<html>
<head>
    <title>Visualisations</title>
</head>
<body>
<!-- use css -->
<style>
    #wrapper {
        margin: 0 auto;
    }
    .orb {
        width: 100px;
        height: 100px;
        background-color: red;
        -moz-border-radius: 50px;
        -webkit-border-radius: 50px;
        border-radius: 50px;
        }
        
</style>
<script src="https://cdn.jsdelivr.net/gh/interactiveJS/interactiveJS@v2.0.1/src/individuals/draggable.min.js"></script>
<p id="debugger">   </p>
<button type="button" id="add_orbs" onclick="ADDORB()">Add Orbs</button>
<script>
    function orblistener(event) {
        var x = event.clientX;
        var y = event.clientY;
        var orb = event.target;
        orb.style.left = x + 'px';
        orb.style.top = y + 'px';
        orb.style.position = 'absolute';
        var id = orb.id;
        //get all orbs x and y
        var orbs = document.getElementsByClassName("orb");
        var x = [];
        var y = [];
        //window width and height
        var width = window.innerWidth;
        var height = window.innerHeight;

        orb.innerHTML = "x: " + orb.style.left + " y: " + orb.style.top+ "<br>";

        for (var i = 0; i < orbs.length; i++) {
            x.push(orbs[i].style.left);
            y.push(orbs[i].style.top);
        }
        
        //send the x and y to the server
        var data = { 'x': x, 'y': y, width: width, height: height};
        let dataJSON = JSON.stringify(data);
        let request = new XMLHttpRequest();

        request.onreadystatechange = function(){
            if (request.readyState === 4) {
                //alert(request.response);
                //split the response by commas
                
                document.getElementById("S").innerHTML = request.response;
            }
        };
        const action = "POST";
        const endpoint = "http://127.0.0.1:5000/data";
        request.open(action, endpoint);
        request.setRequestHeader("Content-Type", "application/json");
        request.send(dataJSON);
        }
    
    function ADDORB() {
        // Remove the last row from the table
        
        var orb = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        node = document.getElementById('graph');
        node.appendChild(orb);
        // count the number of children in the graph
        nodes = document.getElementById('graph').childNodes;
        orb.setAttribute("class", "orb");
        orb.setAttribute("id", "orb"+nodes.length);
        document.getElementById("demo").innerHTML = "Added";

        node.insertAdjacentHTML('afterend', '<div id="orb'+nodes.length+'" class="orb" draggable="true" ondragend="orblistener(event)"></d>');
        node.appendChild(orb);
      
        node.innerHTML = node.innerHTML;
        }
</script>
<button type="button" id="remove_orbs" onclick="REMOVEORB()">Remove Orbs</button>
<p id="demo"></p>
<script>
    function REMOVEORB() {
        document.getElementById("demo").innerHTML = "REmoved";
        let nodes = document.getElementById('graph').childNodes;
        let id = "orb"+nodes.length;
        nodes[nodes.length-1].remove();
        //check html for the id 
        document.getElementById(id).remove();
}
</script>

<div id="header">
    <h1>Visualisations</h1>
</div>
<div class="container" id="graph">

</div> 

<p id="S"></p>


</html>